-- KIỂM TRA ĐỂ XÓA DATABASE NẾU ĐÃ TỒN TẠI
IF EXISTS (  
    SELECT name  
    FROM sys.databases  
    WHERE name = 'TUAN5_NHOM2_TCSDL204'  
)  
BEGIN  
		USE master
		--Đóng tất cả các kết nối đến cơ sở, dữ liệu chuyển sang chế độ single user 
		alter database TUAN5_NHOM2_TCSDL204 set single_user with rollback immediate
		drop database TUAN5_NHOM2_TCSDL204;
END  
GO
CREATE DATABASE TUAN5_NHOM2_TCSDL204
go
USE TUAN5_NHOM2_TCSDL204
go
CREATE TABLE KHACHHANG(
	MAKHACHHANG CHAR(20) PRIMARY KEY,
	TENCONGTY NVARCHAR(50),
	TENGIAODICH NVARCHAR(50),
	DIACHI NVARCHAR(100) NOT NULL,
	EMAIL VARCHAR(30) UNIQUE NOT NULL,
	DIENTHOAI VARCHAR(11) UNIQUE NOT NULL,
	FAX CHAR(10) UNIQUE,
)

CREATE TABLE NHACUNGCAP(
	MACONGTY CHAR(20) PRIMARY KEY,
	TENCONGTY NVARCHAR(50),
	TENGIAODICH NVARCHAR(50),
	DIACHI  VARCHAR(100),
	DIENTHOAI VARCHAR(20),
	FAX CHAR(10),
	EMAIL VARCHAR(30)	
)

CREATE TABLE LOAIHANG(
	MALOAIHANG  CHAR(20) PRIMARY KEY,
	TENLOAIHANG NVARCHAR(50) NOT NULL,
)

CREATE TABLE NHANVIEN(
	MANHANVIEN CHAR(20) PRIMARY KEY,
	HO NVARCHAR(20) NULL,
	TEN NVARCHAR(15) NOT NULL,
	NGAYSINH DATE NOT NULL,
	NGAYLAMVIEC DATE,
	DIACHI NVARCHAR(100) NOT NULL,
	DIENTHOAI VARCHAR(11) UNIQUE,
	LUONGCOBAN DECIMAL(15,2),
	PHUCAP DECIMAL(15,2)
)

CREATE TABLE DONDATHANG (
	SOHOADON CHAR(20) PRIMARY KEY,
	MAKHACHHANG CHAR(20),
	MANHANVIEN CHAR(20),
	NGAYDATHANG DATETIME,
	NGAYGIAOHANG DATETIME,
	NGAYCHUYENHANG DATETIME,
	NOIGIAOHANG NVARCHAR(100)-- NOT NULL
)


CREATE TABLE MATHANG(
	MAHANG CHAR(10) PRIMARY KEY,
	TENHANG NVARCHAR(30) NOT NULL,
	MACONGTY CHAR(20),
	MALOAIHANG CHAR(20),
	SOLUONG FLOAT,
	DONVITINH NVARCHAR(20),
	GIAHANG MONEY,
	
)


CREATE TABLE CHITIETDONHANG(
	SOHOADON CHAR(20),
	MAHANG CHAR(10),
	GIABAN MONEY,
	SOLUONG FLOAT,
	MUCGIAMGIA DECIMAL(5,2), -- LÀ XX,XX%  Á
	PRIMARY KEY(SOHOADON,MAHANG)
)
-- RÀNG BUỘC CÁC KHÓA NGOẠI CHO BẢNG DONDATHANG
ALTER TABLE DONDATHANG
	ADD CONSTRAINT FK_DONDATHANG_MAKHACHHANG FOREIGN KEY (MAKHACHHANG) REFERENCES KHACHHANG(MAKHACHHANG)
				ON DELETE
					CASCADE
				ON UPDATE 
					CASCADE,
		CONSTRAINT FK_DONDATHANG_MANHANVIEN FOREIGN KEY (MANHANVIEN) REFERENCES NHANVIEN(MANHANVIEN)
				ON DELETE
					CASCADE
				ON UPDATE 
					CASCADE

-- RÀNG BUỘC CÁC KHÓA NGOẠI CHO BẢNG CHITIETDONHANG
ALTER TABLE CHITIETDONHANG
	ADD	CONSTRAINT FK_CHITIETDATHANG_SOHOADON FOREIGN KEY (SOHOADON) REFERENCES DONDATHANG(SOHOADON)
				ON DELETE
					CASCADE
				ON UPDATE 
					CASCADE,
		CONSTRAINT FK_CHITIETDATHANG_MAHANG FOREIGN KEY (MAHANG) REFERENCES MATHANG(MAHANG)
				ON DELETE
					CASCADE
				ON UPDATE 
					CASCADE;

-- RÀNG BUỘC CÁC KHÓA NGOẠI CHO BẢNG MATHANG
ALTER TABLE MATHANG
	ADD CONSTRAINT FK_MATHANG_MACONGTY FOREIGN KEY (MACONGTY) REFERENCES NHACUNGCAP(MACONGTY)
				ON DELETE
					CASCADE
				ON UPDATE 
					CASCADE,
		CONSTRAINT FK_MATHANG_LOAIHANG FOREIGN KEY (MALOAIHANG) REFERENCES LOAIHANG(MALOAIHANG)
				ON DELETE
					CASCADE
				ON UPDATE 
					CASCADE

-->>Ràng buộc thiết lập giá trị mặc định bằng 1 cho cột SOLUONG  và bằng 0 cho cột MUCGIAMGIA trong bảng CHITIETDATHANG<<--
ALTER TABLE CHITIETDONHANG
	ADD CONSTRAINT DF_CHITIETDONHANG_SOLUONG DEFAULT 1 FOR SOLUONG, -- ĐỀ BÀI CỦA CÔ
		CONSTRAINT DF_CHITIETDONHANG_MUCGIAMGIA DEFAULT 0 FOR MUCGIAMGIA,
		--Ràng buộc thêm cho giá bán và số lượng lướn hơn 0--
		CONSTRAINT CK_CHITIETDONHANG_GIABAN CHECK (GIABAN >0),
		CONSTRAINT CK_CHITIETDONHANG_SOLUONG CHECK ( SOLUONG>0);


ALTER TABLE DONDATHANG
-->>ngày giao hàng và ngày chuyển hàng phải sau hoặc bằng với ngày đặt hàng ( BÀI TẬP CỦA CÔ) <<--
	ADD CONSTRAINT CK_DONDATHANG_NGAYGIAO CHECK (NGAYGIAOHANG>=NGAYDATHANG),
		CONSTRAINT CK_DONDATHANG_NGAYCHUYENHANG CHECK (
			NGAYCHUYENHANG >= NGAYDATHANG),
		CONSTRAINT DF_DONDATHANG_NGAYDATHANG DEFAULT GETDATE() FOR NGAYDATHANG;

-- MỞ RỘNG ĐỊA CHỈ CỦA KHÁCH HÀNG VÀ NHÂN VIÊN, TRÁNH ĐA TRỊ
CREATE TABLE QUOCGIA(
	MAQG CHAR(15) PRIMARY KEY,
	TENQG NVARCHAR(50)
)
--TẠO TABLE TinhTP
CREATE TABLE TINHTP (
	MATTP CHAR(15) PRIMARY KEY,
	TENTTP NVARCHAR(50),
	QGNO CHAR(15),
	CONSTRAINT FK_TINHTP_MAQG FOREIGN KEY (QGNO) REFERENCES QUOCGIA(MAQG)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE QUANHUYEN (
	MAQH CHAR(15) PRIMARY KEY,
	TENQH NVARCHAR(50),
	TTPNO CHAR(15),
	CONSTRAINT FK_QUANHUYEN_MAQH FOREIGN KEY (TTPNO) REFERENCES TINHTP(MATTP)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE PHUONGXA (
	MAPX CHAR(15) PRIMARY KEY,
	TENPX NVARCHAR(50),
	QHNO CHAR(15),
	CONSTRAINT FK_PHUONGXA_MATTP FOREIGN KEY (QHNO) REFERENCES QUANHUYEN(MAQH)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

-- XÓA CỘT diaChi VÀ THAY BẰNG CỘT soNhaTenDuong VÀ LIÊN KẾT VỚI BẢNG PHUONGXA QUA KHÓA NGOẠI maPXNo
ALTER TABLE KhachHang
	DROP COLUMN DIACHI;
ALTER TABLE NHANVIEN
	DROP COLUMN DIACHI;
ALTER TABLE NHACUNGCAP
	DROP COLUMN DIACHI;
ALTER TABLE DONDATHANG
	DROP COLUMN NOIGIAOHANG;
-- THÊM 2 CỘT soNhaTenDuong VÀ maPXNo VÀO BẢNG KhachHang
ALTER TABLE KhachHang
	ADD soNhaTenDuong NVARCHAR(50) NULL,
		PXNo CHAR(15),
		CONSTRAINT FK_KhachHang_maPX FOREIGN KEY (PXNo) REFERENCES PhuongXa(maPX)
			ON DELETE CASCADE
			ON UPDATE CASCADE;

-- THÊM 2 CỘT soNhaTenDuong VÀ maPXNo VÀO BẢNG NHANVIEN
ALTER TABLE NHANVIEN
	ADD soNhaTenDuong NVARCHAR(50) NULL,
		PXNo CHAR(15),
		CONSTRAINT FK_NHANVIEN_maPX FOREIGN KEY (PXNo) REFERENCES PhuongXa(maPX)
			ON DELETE NO ACTION
			ON UPDATE NO ACTION;

-- THÊM 2 CỘT soNhaTenDuong VÀ maPXNo VÀO BẢNG NHACUNGCAP
ALTER TABLE NHACUNGCAP
	ADD soNhaTenDuong NVARCHAR(50) NULL,
		PXNo CHAR(15),
		CONSTRAINT FK_NHACUNGCAP_maPX FOREIGN KEY (PXNo) REFERENCES PhuongXa(maPX)
			ON DELETE NO ACTION
			ON UPDATE NO ACTION;
ALTER TABLE DONDATHANG
	ADD soNhaTenDuong NVARCHAR(50) NULL,
		PXNo CHAR(15),
		CONSTRAINT FK_DONDATHANG_MAPX FOREIGN KEY (PXNo) REFERENCES PhuongXa(maPX)
			ON DELETE NO ACTION
			ON UPDATE NO ACTION;

ALTER TABLE MATHANG
	ADD DONGIANHAP MONEY
--ràng buộc cho bảng NHANVIEN để đảm bảo rằng một nhân viên chỉ có thể làm việc trong công ty khi đủ 18 tuổi và không quá 60 tuổi.
--DATEDIFF(YEAR, DoB, GETDATE()) >= 18: Hàm này sẽ tính số năm giữa ngày sinh (DoB) và ngày hiện tại (GETDATE()).
--DoB <= CAST(DATEADD(YEAR, -18, GETDATE()) AS DATE) 
		--DATEADD(datepart, number, date)
				--datepart: Phần mà bạn muốn thêm (như năm, tháng, ngày, v.v.).
				--number: Số lượng mà bạn muốn thêm (trong trường hợp này là -18 để trừ đi 18 năm).
				--date: Ngày gốc mà bạn muốn thêm vào (trong trường hợp này là GETDATE()).
		-- CAST(... AS DATE):Chuyển đổi kết quả của hàm DATEADD sang kiểu dữ liệu DATE để đảm bảo so sánh chính xác.

ALTER TABLE NHANVIEN
	ADD CONSTRAINT CK_NHANVIEN_NGAYSINH CHECK (NGAYSINH <= CAST(DATEADD(YEAR, -18, GETDATE()) AS DATE)
       AND NGAYSINH >= CAST(DATEADD(YEAR, -60, GETDATE()) AS DATE))




-- RÀNG BUỘC SỐ ĐIỆN THOẠI VÀ EMAIL CHO BẢNG KHACHHANG VÀ NHANVIEN
ALTER TABLE KHACHHANG
	ADD CONSTRAINT CK_KHACHHANG_SDT CHECK(LEN(DIENTHOAI ) >= 10 AND DIENTHOAI NOT LIKE '%[^0-9]%'),
		CONSTRAINT CK_KHACHHANG_EMAIL CHECK (EMAIL like '[A-Za-z]%@%'),
-- MẶT ĐỊNH TÊN CÔNG TY CỦA KHÁCH HÀNG LÀ 0 ĐỂ KHI MÌNH THỐNG KÊ KHÁCH HANGF THÌ MÌNH CHỈ CẦN  THỐNG KÊ LÀ O
		CONSTRAINT DF_KHACHHANG_TENCONGTY DEFAULT 0 FOR TENCONGTY

--Table NhanVien
ALTER TABLE NHANVIEN
	ADD CONSTRAINT CK_NHANVIEN_SDT CHECK(LEN(DIENTHOAI ) >= 10 AND DIENTHOAI NOT LIKE '%[^0-9]%');
		



--Chèn dữ liệu vào bảng QuocGia
INSERT INTO QUOCGIA (MAQG,TENQG)
	VALUES 
	('VIE', N'Việt Nam'),
	('USA', N'Hoa Kỳ'),
	('JPN', N'Nhật Bản'),
	('FRA', N'Pháp'),
	('GER', N'Đức'),
	('IND', N'Ấn Độ'),
	('ESP', N'Tây Ban Nha'),
	('POR', N'Bồ Đào Nha'),
	('POL', N'Ba Lan'),
	('ITA', N'Ý')

	--Chèn dữ liệu vào bảng TinhThanh
	INSERT INTO TINHTP (MATTP, TENTTP,QGNO)
	VALUES
	('HN', N'Hà Nội', 'VIE'),
	('BT', N'Bình Thuận', 'VIE'),
	('DN', N'Đà Nẵng', 'VIE'),
	('HP', N'Hải Phòng', 'VIE'),
	('CT', N'Cần Thơ', 'VIE'),
	('LA', N'Long An', 'VIE'),
	('BD', N'Bình Định', 'VIE'),
	('KH', N'Khánh Hòa', 'VIE'),
	('QT', N'Quảng Trị', 'VIE'),
	('QN', N'Quảng Nam', 'VIE')

	--Chèn dữ liệu vào bảng QuanHuyen
	INSERT INTO QUANHUYEN (MAQH, TENQH,TTPNO) 
	VALUES
	('HC', N'Hải Châu', 'DN'),
	('TK', N'Thanh Khê', 'DN'),
	('ST', N'Sơn Trà', 'DN'),
	('TP', N'Triệu Phong', 'QT'),
	('LC', N'Liên Chiểu', 'DN'),
	('CL', N'Cẩm Lệ', 'DN'),
	('DB', N'Điện Bàn', 'QN'),
	('HL', N'Hải Lăng', 'QT'),
	('VL', N'Vĩnh Linh', 'QT'),
	('DL', N'Đại Lộc', 'QN')
	-- Chèn dữ liệu vào bảng PhuongXa
	INSERT INTO PHUONGXA (MAPX,TENPX,QHNO)
	VALUES
	('PX1', N'Thanh Bình', 'HC'),
	('PX2', N'Bình Thuận', 'HC'),
	('PX3', N'An Khê', 'TK'),
	('PX4', N'Hòa Khê', 'TK'),
	('PX5', N'Phước Mỹ', 'ST'),
	('PX6', N'Hải Ba', 'HL'),
	('PX7', N'Triệu Thành', 'TP'),
	('PX8', N'Hải Thiện', 'HL'),
	('PX9', N'Hòa Phát', 'CL'),
	('PX10', N'Vĩnh Điện', 'DB')
-- Chèn dữ liệu vào bảng NhanVien
SET DATEFORMAT DMY
INSERT INTO NHANVIEN(MANHANVIEN,HO,TEN,NGAYSINH,NGAYLAMVIEC,DIENTHOAI,LUONGCOBAN,PHUCAP,PXNo,soNhaTenDuong)
VALUES
		('NV1', N'Võ', N'Hiếu', '20-08-2005', '23-03-2024', '0912348524', 1000000, 200000,'PX1', '112 Nguyễn Tri Phương'),
		('NV2', N'Tran', N'Phương', '15-12-1992', '01-05-2023', '0912345678', 1200000, 300000,'PX2', '456 Lê Lợi'),
		('NV3', N'Nguyen', N'Hiền', '15-12-1992', '15-06-2023', '0909876543', 1500000, 250000,'PX3','789 Trần Hưng Đạo'),
		('NV4', N'Lê', N'Quang', '30-07-1990', '10-07-2023', '0922334455', 1100000, 200000,'PX2', '101 Nguyễn Thị Minh Khai'),
		('NV5', N'Phạm', N'Thanh', '11-09-1988', '20-08-2023', '0933445566', 1300000, 300000,'PX5','102 Hai Bà Trưng'),
		('NV6', N'Hoàng', N'Trân', '28-02-1995', '25-09-2023', '0944556677', 1400000, 350000,'PX3','103 Lê Duẩn'),
		('NV7', N'Bùi', N'Yến', '14-11-1993', '01-10-2023', '0966778899', 1250000, 220000, 'PX7','456 Ngô Gia Tự'),
		('NV8', N'Đỗ', N'Thảo', '09-04-1991', '10-11-2023', '0988776655', 1350000, 240000, 'PX6','789 Lý Thường Kiệt'),
		('NV9', N'Vương', N'Khoa', '18-06-1994', '05-12-2023', '0977665544', 1450000, 260000,'PX10', '123 Đinh Tiên Hoàng'),
		('NV10', N'Dương', N'Lan', '01-01-1987', '20-01-2024', '0999443322', 1550000, 280000, 'PX9','456 Trường Chinh');

SET DATEFORMAT DMY
	-- Chèn dữ liệu vào bảng KhachHang
INSERT INTO KHACHHANG(MAKHACHHANG,TENCONGTY,TENGIAODICH,EMAIL,DIENTHOAI,FAX,PXNo,soNhaTenDuong)
	VALUES 
	   ('KH001', N'VINAMILK', N'NguyenVanAn', 'nguyenvana@gmail.com', '0912345678', '0234567890','PX1', N'123 Đường Tôn Đản'),
		('KH002', N'Samsung', N'HoangThiBich', 'tranthib@gmail.com', '0912345679', '0234567891','PX2',  N'456 Đường Lê Lợi'),
		('KH003',N'Nike', N'Chocos', 'phamvanc@gmail.com', '0912345680', '0234567892', 'PX2',N'789 Đường Nguyễn Du'),
		('KH004', N'Công ty D', N'TranMinhChau', 'hoangthid@gmail.com', '0912345681', '0234567893','PX1', N'101 Đường Trần Hưng Đạo'),
		('KH005', N'Công ty E', N'PANA', 'levane@gmail.com', '0912345682', '0234567894', 'PX4', N'102 Đường Hai Bà Trưng'),
		('KH006', N'Công ty F', N'SONYS', 'vovanf@gmail.com', '0912345683', '0234567895', 'PX1', N'103 Đường Lê Duẩn'),
		('KH007', N'Công ty G', N'MICRO', 'ngothig@gmail.com', '0912345684', '0234567896','PX5', N'104 Đường Ngô Gia Tự'),
		('KH008', N'Công ty H', N'BuiVanAnhThu', 'buivanh@gmail.com', '0912345685', '0234567897', 'PX7', N'105 Đường Lý Thường Kiệt'),
		('KH009', N'Công ty I', N'VIDIA', 'trinhthi@gmail.com', '0912345686', '0234567898','PX6',  N'106 Đường Đinh Tiên Hoàng'),
		('KH010', N'Công ty J', N'DoVanHoangDieu', 'dovanj@gmail.com', '0912345687', '0234567899','PX9',  N'107 Đường Trường Chinh');
	-- Chèn dữ liệu vào bảng LoaiHang
INSERT INTO LOAIHANG (MALOAIHANG,TENLOAIHANG)
VALUES 
		('LH001', N'Điện thoại di động'),
		('LH002', N'Thực phẩm'),
		('LH003', N'Nước'),
		('LH004', N'Thời trang nam'),
		('LH005', N'Thời trang nữ'),
		('LH006', N'Dụng cụ nhà bếp'),
		('LH007', N'Đồ điện gia dụng'),
		('LH008', N'Văn phòng phẩm'),
		('LH009', N'Thiết bị mạng'),
		('LH010', N'Phụ kiện điện thoại');

INSERT INTO NHACUNGCAP (MACONGTY,TENCONGTY,TENGIAODICH,DIENTHOAI,EMAIL,FAX,PXNo,soNhaTenDuong)
VALUES 
		('CT001', N'VINAMILK', N'VINAMILK', '0912345678', 'apple@apple.com', '0234567890', 'PX1', N'123 Đường Tôn Đản'),
		('CT002', N'Việt Tiến', N'VINAMILK', '0912345679', 'samsung@samsung.com', '0234567891', 'PX2', N'456 Đường Lê Lợi'),
		('CT003', N'Choco', N'Chocos', '0912345680', 'nike@nike.com', '0234567892', 'PX3', N'789 Đường Nguyễn Du'),
		('CT004', N'Choco', N'AMD', '0912345681', 'adidas@adidas.com', '0234567893', 'PX4', N'101 Đường Trần Hưng Đạo'),
		('CT005', N'Panasonic', N'PANA', '0912345682', 'panasonic@panasonic.com', '0234567894', 'PX5', N'102 Đường Hai Bà Trưng'),
		('CT006', N'Sony', N'SONYS', '0912345683', 'sony@sony.com', '0234567895', 'PX6', N'103 Đường Lê Duẩn'),
		('CT007', N'Microsoft', N'MICRO', '0912345684', 'microsoft@microsoft.com', '0234567896', 'PX7', N'104 Đường Ngô Gia Tự'),
		('CT008', N'VINAMILK', N'AMD', '0912345685', 'intel@intel.com', '0234567897', 'PX8', N'105 Đường Lý Thường Kiệt'),
		('CT009', N'AMD', N'VIDIA', '0912345686', 'amd@amd.com', '0234567898', 'PX9', N'106 Đường Đinh Tiên Hoàng'),
		('CT010', N'Nvidia', N'INTEN', '0912345687', 'nvidia@nvidia.com', '0234567899', 'PX10', N'107 Đường Trường Chinh');
	-- Chèn dữ liệu vào bảng MatHang

INSERT INTO MATHANG (MAHANG, TENHANG, MACONGTY, MALOAIHANG, SOLUONG, DONVITINH, GIAHANG, DONGIANHAP)
VALUES 
		('MH001', N'iPhone 14', 'CT002', 'LH001', 50, N'Cái', 25000000.00, 150000),
		('MH002', N'Samsung Galaxy S23', 'CT002', 'LH001', 40, N'Cái', 20000000.00, 500000),
		('MH003', N'Coffee', 'CT001', 'LH002', 30, N'Cái', 30000000.00, 612000),
		('MH004', N'Sữa hộp XYZ', 'CT003', 'LH002', 20, N'Hộp', 40000000.00, 170000),
		('MH005', N'Sinh tố lúa mạch', 'CT003', 'LH002', 100, N'Cái', 200000.00, 170000),
		('MH006', N'Váy Nữ', 'CT004', 'LH005', 80, N'Cái', 500000.00, 410000),
		('MH007', N'Nồi Cơm Điện', 'CT005', 'LH006', 60, N'Cái', 1500000.00, 990000),
		('MH008', N'Tủ Lạnh', 'CT006', 'LH007', 15, N'Cái', 8000000.00, 760000),
		('MH009', N'Sổ Tay', 'CT007', 'LH008', 200, N'Cuốn', 50000.00, 42000),
		('MH010', N'Dâu tây', 'CT008', 'LH003', 25, N'Hộp', 1200000.00, 980000);


SET DATEFORMAT DMY
INSERT INTO DONDATHANG (SOHOADON,MAKHACHHANG,MANHANVIEN,NGAYDATHANG,NGAYCHUYENHANG,NGAYGIAOHANG,PXNO,soNhaTenDuong)
	VALUES 
		('HD001', 'KH001', 'NV1', GETDATE(), GETDATE()+5, GETDATE()+6,'PX5', N'123 Đường Tôn Đản'),
		('HD002', 'KH002', 'NV2', '02-01-2024', NULL, '11-01-2024','PX3',NULL),
		('HD003', 'KH002', 'NV3', '03-01-2023', NULL, '12-01-2023',NULL, NULL),
		('HD004', 'KH003', 'NV2', '04-01-2022', NULL, '13-01-2022', 'PX7',N'101 Đường Trần Hưng Đạo'),
		('HD005', 'KH004', 'NV3', '05-01-2022', '09-01-2022', '14-01-2022','PX5', N'102 Đường Hai Bà Trưng'),
		('HD006', 'KH002', 'NV6', '06-01-2022', '10-01-2022', '15-01-2022','PX4', N'103 Đường Lê Duẩn'),
		('HD007', 'KH005', 'NV7', GETDATE(), GETDATE()+2, GETDATE()+6,'PX3', N'104 Đường Ngô Gia Tự'),
		('HD008', 'KH008', 'NV8', '08-01-2023', '12-01-2023', '17-01-2023','PX2', N'105 Đường Lý Thường Kiệt'),
		('HD009', 'KH009', 'NV9', GETDATE(), GETDATE()+2, GETDATE()+6,'PX9',NULL),
		('HD010', 'KH010', 'NV10', '10-01-2023', NULL, '19-01-2023','PX10', NULL);

	-- Chèn dữ liệu vào bảng ChiTietDonHang
INSERT INTO CHITIETDONHANG (SOHOADON,MAHANG,GIABAN,SOLUONG,MUCGIAMGIA)
VALUES 
		('HD001', 'MH002', 25000000, 4, 0.00),
		('HD002', 'MH004', 20000000, 3, 0.00),
		('HD002', 'MH003', 30000000, 2, 0.05),
		('HD004', 'MH003', 40000000, 1, 0.10),
		('HD004', 'MH005', 200000, 1, 0.00),
		('HD005', 'MH004', 500000, 2, 0.00),
		('HD007', 'MH006', 1500000, 5, 0.10),
		('HD007', 'MH008', 8000000, 2, 0.15),
		('HD009', 'MH008', 50000, 1000, 0.00),
		('HD010', 'MH010', 1200000, 1000, 0.05)

-------------------------TUẦN 8------------------------------------------

-->> A.Cập nhật lại giá trị trường NGAYCHUYENHANG của những bản ghi có NGAYCHUYENHANG
--chưa xác định (NULL) trong bảng DONDATHANG bằng với giá trị của trường NGAYDATHANG.
SELECT * FROM DONDATHANG

UPDATE DONDATHANG
SET NGAYCHUYENHANG=NGAYDATHANG
WHERE NGAYCHUYENHANG IS NULL

SELECT * FROM DONDATHANG
-->> B.Tăng số lượng hàng của những mặt hàng do công ty VINAMILK cung cấp lên gấp đôi.
SELECT NCC.TENCONGTY,MH.SOLUONG
FROM NHACUNGCAP AS NCC, MATHANG AS MH
WHERE NCC.MACONGTY= MH.MACONGTY

UPDATE MATHANG
SET SOLUONG=SOLUONG*2
WHERE MACONGTY in (
	SELECT MACONGTY
	FROM NHACUNGCAP
	WHERE TENCONGTY=N'VINAMILK'
)

SELECT NCC.TENCONGTY,MH.SOLUONG
FROM NHACUNGCAP AS NCC, MATHANG AS MH
WHERE NCC.MACONGTY= MH.MACONGTY

--C.Cập nhật giá trị của trường NOIGIAOHANG trong bảng DONDATHANG bằng địa chỉ của khách hàng đối với
--những đơn đặt hàng chưa xác định được nơi giao hàng (giá trị trường NOIGIAOHANG bằng NULL).
UPDATE DONDATHANG
SET DONDATHANG.soNhaTenDuong= KH.soNhaTenDuong,
	DONDATHANG.PXNo= KH.PXNo
FROM DONDATHANG AS DDH, KHACHHANG AS KH
WHERE DDH.MAKHACHHANG = KH.MAKHACHHANG AND  DDH.soNhaTenDuong IS NULL

SELECT * FROM DONDATHANG
-- HOẶC
UPDATE DDH
SET DDH.soNhaTenDuong = KH.soNhaTenDuong,
    DDH.PXNo = KH.PXNo
FROM DONDATHANG AS DDH
JOIN KHACHHANG AS KH ON DDH.MAKHACHHANG = KH.MAKHACHHANG
WHERE DDH.soNhaTenDuong IS NULL;


--D.Cập nhật lại dữ liệu trong bảng KHACHHANG sao cho nếu tên công ty
--và tên giao dịch của khách hàng trùng với tên công ty và
--tên giao dịch của một nhà cung cấp nào đó thì địa chỉ, điện thoại, fax và e-mail phải giống nhau.

UPDATE KHACHHANG
SET KHACHHANG.DIENTHOAI=NCC.DIENTHOAI,
	KHACHHANG.EMAIL=NCC.EMAIL,
	KHACHHANG.FAX=NCC.FAX
FROM KHACHHANG AS KH, NHACUNGCAP AS NCC
WHERE KH.TENCONGTY=NCC.TENCONGTY AND KH.TENGIAODICH=NCC.TENGIAODICH

--E.Tăng lương lên gấp rưỡi cho những nhân viên bán được số lượng hàng nhiều hơn 100 trong năm 2022.
UPDATE NHANVIEN
SET LUONGCOBAN=LUONGCOBAN*1.5
WHERE NHANVIEN.MANHANVIEN IN(
	SELECT NV.MANHANVIEN
	FROM NHANVIEN AS NV, DONDATHANG AS DDH, CHITIETDONHANG AS CTDH
	WHERE NV.MANHANVIEN=DDH.MANHANVIEN AND CTDH.SOHOADON=DDH.SOHOADON
		AND YEAR(DDH.NGAYDATHANG) = 2022
	GROUP BY NV.MANHANVIEN
	HAVING SUM(CTDH.SOLUONG)>100
)
--F.Tăng phụ cấp lên bằng 50% lương cho những nhân viên bán được hàng nhiều nhất.
UPDATE NHANVIEN
SET PHUCAP = LUONGCOBAN * 0.5
WHERE EXISTS --MANHANVIEN IN 
(
    SELECT TOP 1 WITH TIES DDH.MANHANVIEN, SUM(CTDH.SOLUONG)
    FROM DONDATHANG AS DDH,CHITIETDONHANG AS CTDH
    WHERE CTDH.SOHOADON = DDH.SOHOADON
    GROUP BY DDH.MANHANVIEN
    ORDER BY SUM(CTDH.SOLUONG) DESC  
	)

--HOẶC
DECLARE @MaxQuantity FLOAT;

SELECT  MAX(TONGSL)
FROM (
    SELECT DDH.MANHANVIEN, SUM(CTDH.SOLUONG) AS TONGSL
    FROM DONDATHANG AS DDH, CHITIETDONHANG AS CTDH
    GROUP BY DDH.MANHANVIEN
) AS NVBANHANG;

PRINT @MaxQuantity
-- Cập nhật phụ cấp cho nhân viên bán được hàng nhiều nhất
/*UPDATE NHANVIEN
SET PHUCAP = 0.5 * LUONGCOBAN
WHERE MANHANVIEN IN (
    SELECT DDH.MANHANVIEN
    FROM DONDATHANG AS DDH, CHITIETDONHANG AS CTDH
    GROUP BY DDH.MANHANVIEN
    HAVING SUM(CTDH.SOLUONG) =(
		SELECT  MAX(TONGSL)
		FROM (
		SELECT DDH.MANHANVIEN, SUM(CTDH.SOLUONG) AS TONGSL
		FROM DONDATHANG AS DDH, CHITIETDONHANG AS CTDH
		GROUP BY DDH.MANHANVIEN
		) AS NVBANHANG
	)
);*/
go
-- TRÍ TUỆ
UPDATE NHANVIEN
SET PHUCAP = LUONGCOBAN * 0.5
WHERE MANHANVIEN IN (
	SELECT MANHANVIEN
	FROM DONDATHANG D, CHITIETDONHANG C
	WHERE D.SOHOADON = C.SOHOADON 
	GROUP BY D.MANHANVIEN
	HAVING SUM(SOLUONG) =(
		SELECT TOP 1 SUM(SOLUONG)
		FROM DONDATHANG D, CHITIETDONHANG C
		WHERE D.SOHOADON = C.SOHOADON 
		GROUP BY D.MANHANVIEN
		ORDER BY SUM(SOLUONG) DESC
	)
)
--F. Giảm 25% lương của những nhân viên trong năm 2023 không lập được bất kỳ đơn đặt hàng nào.
UPDATE NHANVIEN
SET LUONGCOBAN = LUONGCOBAN * 0.75
WHERE MANHANVIEN IN (
    SELECT NV.MANHANVIEN
    FROM NHANVIEN AS NV
    LEFT JOIN DONDATHANG AS DDH
    ON NV.MANHANVIEN = DDH.MANHANVIEN 
    AND YEAR(DDH.NGAYDATHANG) = 2023 AND YEAR(NV.NGAYLAMVIEC)<2024  -- Chỉ lọc năm 2023 trong điều kiện JOIN
    WHERE DDH.SOHOADON IS NULL      
);

------>> SỬ DỤNG CÂU SELECT TUẦN 9 <<--------

--1. Địa chỉ và điện thoại của nhà cung cấp có tên giao dịch [VINAMILK]  là gì?

select * from NHACUNGCAP
SELECT soNhaTenDuong, DIENTHOAI 
FROM NHACUNGCAP 
WHERE TENGIAODICH = N'VINAMILK';

--2. Loại hàng thực phẩm do những công ty nào cung cấp và địa chỉ của các công ty đó là gì?
/*select * from LOAIHANG
select * from MATHANG
select * from NHACUNGCAP*/

SELECT DISTINCT NCC.TENCONGTY, TENLOAIHANG, NCC.soNhaTenDuong 
FROM NHACUNGCAP NCC, MATHANG MH, LOAIHANG LH
WHERE NCC.MACONGTY = MH.MACONGTY AND MH.MALOAIHANG = LH.MALOAIHANG AND LH.TENLOAIHANG = N'Thực phẩm';

--3. Những khách hàng nào (tên giao dịch) đã đặt mua mặt hàng Sữa hộp XYZ của công ty?
/*select * from KHACHHANG
select * from DONDATHANG
select * from CHITIETDONHANG
select * from MATHANG*/

SELECT DISTINCT KH.MAKHACHHANG, KH. TENGIAODICH
FROM KHACHHANG KH, DONDATHANG DDH, CHITIETDONHANG CTDH,  MATHANG MH
WHERE KH.MAKHACHHANG = DDH.MAKHACHHANG AND DDH.SOHOADON = CTDH.SOHOADON AND CTDH.MAHANG = MH.MAHANG AND MH.TENHANG = N'Sữa hộp XYZ';

--4. Những đơn đặt hàng nào yêu cầu giao hàng ngay tại công ty đặt hàng và những đơn đó là của công ty nào?

SELECT DDH.SOHOADON, KH.TENCONGTY
FROM DONDATHANG DDH, KHACHHANG KH
WHERE DDH.MAKHACHHANG = KH.MAKHACHHANG AND DDH.PXNo = KH.PXNo AND DDH.soNhaTenDuong = KH.soNhaTenDuong;

--5. Tổng số tiền mà khách hàng phải trả cho mỗi đơn đặt hàng là bao nhiêu?

SELECT DDH.SOHOADON, SUM(CTDH.SOLUONG * CTDH.GIABAN) AS TongTien
FROM DONDATHANG DDH, CHITIETDONHANG CTDH
WHERE DDH.SOHOADON = CTDH.SOHOADON
GROUP BY DDH.SOHOADON;

--6. Hãy cho biết tổng số tiền lời mà công ty thu  được từ mỗi mặt hàng trong năm 2022.
select * from MATHANG
/*update MATHANG
set DONGIANHAP = 160000
where MAHANG = 'MH001'
update MATHANG
set DONGIANHAP = 500000
where MAHANG = 'MH002'
update MATHANG
set DONGIANHAP = 612000
where MAHANG = 'MH003'
update MATHANG
set DONGIANHAP = 170000
where MAHANG = 'MH004'
update MATHANG
set DONGIANHAP = 160000
where MAHANG = 'MH005'
update MATHANG
set DONGIANHAP = 410000
where MAHANG = 'MH006'
update MATHANG
set DONGIANHAP = 990000
where MAHANG = 'MH007'
update MATHANG
set DONGIANHAP = 160000
where MAHANG = 'MH008'
update MATHANG
set DONGIANHAP = 42000
where MAHANG = 'MH009'
update MATHANG
set DONGIANHAP = 980000
where MAHANG = 'MH010'*/


SELECT MH.TENHANG, SUM((CTDH.GIABAN - MH.DONGIANHAP) * CTDH.SOLUONG) AS TongTienLoi
FROM CHITIETDONHANG CTDH, MATHANG MH, DONDATHANG DDH
WHERE CTDH.MAHANG = MH.MAHANG AND CTDH.SOHOADON = DDH.SOHOADON AND YEAR(DDH.NGAYDATHANG) = 2022
GROUP BY MH.TENHANG;

--->> TUẦN 9. SELECT VIẾT CÁC YÊU CẦU TRUY VẤN <<----
--1.  Mã hàng, tên hàng, số lượng và các mặt hàng hiện có trong công ty
SELECT MH.MAHANG, MH.TENHANG, (MH.SOLUONG - CTDH.SOLUONG) AS SL_CONLAI
FROM MATHANG AS MH
INNER JOIN CHITIETDONHANG AS CTDH ON MH.MAHANG = CTDH.MAHANG
GROUP BY MH.MAHANG, MH.TENHANG, MH.SOLUONG, CTDH.SOLUONG
GO

SELECT * FROM CHITIETDONHANG
SELECT * FROM MATHANG

--2. HÃY CHO BIẾT MỖI MẶT HÀNG TRONG CÔNG TY DO AI CUNG CẤP
SELECT MH.MAHANG, MH.TENHANG, NCC.TENCONGTY
FROM MATHANG AS MH
INNER JOIN  NHACUNGCAP AS NCC
ON MH.MACONGTY=NCC.MACONGTY

SELECT * FROM MATHANG
SELECT * FROM NHACUNGCAP
--GO
--3. HÃY CHO BIẾT SỐ TIỀN LƯƠNG MÀ CÔNG TY PHẢI TRẢ CHO MỖI NHÂN VIÊN LÀ BAO NHIÊU

UPDATE  NHANVIEN
SET LUONGCOBAN=0
WHERE LUONGCOBAN IS NULL 

UPDATE  NHANVIEN
SET PHUCAP=0
WHERE PHUCAP IS NULL 



SELECT MANHANVIEN, HO,TEN, LUONGCOBAN+PHUCAP AS N'Tiền lương'
FROM NHANVIEN

SELECT * FROM NHANVIEN

--4. NHỮNG MẶT HÀNG NÀO CHƯA ĐƯỢC KHÁCH HÀNG MUA
SELECT MAHANG
FROM MATHANG
EXCEPT
SELECT MAHANG
FROM CHITIETDONHANG

SELECT MATHANG.*
FROM MATHANG 
WHERE MAHANG NOT IN (
	SELECT MAHANG
	FROM CHITIETDONHANG
)

SELECT * FROM MATHANG
SELECT * FROM CHITIETDONHANG

--5. HÃY CHO BIẾT MỖI KHÁCH HÀNG PHẢI BỎ RA BAO NHIÊU TIỀN ĐỂ MUA HÀNG CỦA CÔNG TY ?

-- BƯỚC 1.
GO
CREATE VIEW TONGTIEN_MOIHOADON AS 
	SELECT SOHOADON, SUM( GIABAN*SOLUONG*(1-MUCGIAMGIA)) AS[TONGTIEN]
	FROM CHITIETDONHANG
	GROUP BY SOHOADON

GO
-- BƯỚC 2.
SELECT  KH.MAKHACHHANG, KH.TENCONGTY, SUM(TONGTIEN) --,DDH.SOHOADON,
FROM KHACHHANG AS KH, DONDATHANG AS DDH, TONGTIEN_MOIHOADON AS TTMHD
WHERE KH.MAKHACHHANG = DDH.MAKHACHHANG AND DDH.SOHOADON=TTMHD.SOHOADON
GROUP BY KH.MAKHACHHANG, KH.TENCONGTY

SELECT * FROM KHACHHANG
SELECT * FROM DONDATHANG
SELECT * FROM CHITIETDONHANG


--6.HÃY CHO BIẾT SỐ TIỀN LỜI MÀ CÔNG TY THU ĐƯỢC TỪ MỖI MẶT HÀNG TRONG NĂM 2022
SELECT MH.MAHANG, MH.MACONGTY, SUM(CTDH.SOLUONG*(CTDH.GIABAN*(1-CTDH.MUCGIAMGIA)-MH.GIAHANG)) AS [TIỀN LỜI]
FROM MATHANG AS MH, CHITIETDONHANG AS CTDH, DONDATHANG AS DDH
WHERE  DDH.SOHOADON=CTDH.SOHOADON AND  CTDH.MAHANG=MH.MAHANG AND
	YEAR(DDH.NGAYDATHANG)= 2022 AND YEAR(DDH.NGAYGIAOHANG)= 2022
	AND YEAR(DDH.NGAYCHUYENHANG)= 2022	  
GROUP BY MH.MAHANG,MH.MACONGTY


-------------------------<< BÀI TẬP NHÓM TUẦN 10 >>------------------------


--1.	Cho biết danh sách các đối tác cung cấp hàng cho công ty
SELECT  DISTINCT NCC.TENCONGTY AS [TÊN CÔNG TY]
FROM NHACUNGCAP NCC
LEFT JOIN MATHANG MH 
ON NCC.MACONGTY = MH.MACONGTY;

--2.	Mã hàng, tên hàng và số lượng của các mặt hàng hiện có trong công ty.
SELECT NCC.TENCONGTY, MH.MAHANG, MH.TENHANG, MH.SOLUONG AS [SỐ LƯỢNG NHẬP], 
SUM(CTDH.SOLUONG) AS [SỐ LƯỢNG ĐÃ BÁN], (MH.SOLUONG - SUM(CTDH.SOLUONG)) AS [SỐ LƯỢNG CÒN]
FROM MATHANG MH 
JOIN CHITIETDONHANG CTDH 
ON MH.MAHANG = CTDH.MAHANG
JOIN NHACUNGCAP NCC
ON MH.MACONGTY = NCC.MACONGTY
GROUP BY NCC.TENCONGTY, MH.MAHANG, MH.TENHANG, MH.SOLUONG

--3.	Họ tên và địa chỉ và năm bắt đầu làm việc của các nhân viên trong công ty
SELECT CONCAT(HO, ' ', TEN) AS HoTen, soNhaTenDuong, YEAR(NGAYLAMVIEC) AS NamBatDauLamViec
FROM NHANVIEN;

--4.	Địa chỉ và điện thoại của nhà cung cấp có tên giao dịch [VINAMILK]  là gì?
SELECT soNhaTenDuong, DIENTHOAI
FROM NHACUNGCAP
WHERE TENGIAODICH = N'VINAMILK';

--5.	Cho biết mã và tên của các mặt hàng có giá lớn hơn 100000 và số lượng hiện có ít hơn 50.
SELECT 
    MH.MAHANG,
    MH.TENHANG,
    MH.GIAHANG,
    MH.SOLUONG AS [SỐ LƯỢNG NHẬP],
    SUM(CTDH.SOLUONG) AS [SỐ LƯỢNG ĐÃ BÁN],
    (MH.SOLUONG - SUM(CTDH.SOLUONG)) AS [SỐ LƯỢNG CÒN]
FROM MATHANG MH
JOIN CHITIETDONHANG CTDH 
ON MH.MAHANG = CTDH.MAHANG
WHERE MH.GIAHANG > 100000 AND MH.SOLUONG < 50
GROUP BY MH.MAHANG, MH.TENHANG, MH.GIAHANG, MH.SOLUONG;

--6. 	Cho biết mỗi mặt hàng trong công ty do ai cung cấp
SELECT MH.TENHANG AS [TÊN HÀNG], NCC.TENCONGTY AS [TÊN CÔNG TY CUNG CẤP]
FROM MATHANG MH
JOIN NHACUNGCAP NCC 
ON MH.MACONGTY = NCC.MACONGTY;

--7.	Công ty [Việt Tiến] đã cung cấp những mặt hàng nào?
SELECT DISTINCT MH.TENHANG , NCC.TENCONGTY
FROM MATHANG MH
JOIN NHACUNGCAP NCC
ON MH.MACONGTY = NCC.MACONGTY
WHERE NCC.TENCONGTY = 'Việt Tiến';

--8.	Loại hàng thực phẩm do những công ty nào cung cấp và địa chỉ của các công ty đó là gì?
SELECT NCC.TENCONGTY AS [TÊN CÔNG TY], NCC.soNhaTenDuong AS [ĐỊA CHỈ]
FROM NHACUNGCAP NCC
JOIN MATHANG MH 
ON NCC.MACONGTY = MH.MACONGTY
JOIN LOAIHANG LH 
ON MH.MALOAIHANG = LH.MALOAIHANG
WHERE LH.TENLOAIHANG = 'Thực phẩm';

--9.	Những khách hàng nào (tên giao dịch) đã đặt mua mặt hàng Sữa hộp XYZ của công ty?
SELECT KH.TENGIAODICH AS [TÊN KHÁCH HÀNG]
FROM KHACHHANG KH
JOIN DONDATHANG DDH 
ON KH.MAKHACHHANG = DDH.MAKHACHHANG
JOIN CHITIETDONHANG CTDH 
ON DDH.SOHOADON = CTDH.SOHOADON
JOIN MATHANG MH 
ON CTDH.MAHANG = MH.MAHANG
WHERE MH.TENHANG = 'Sữa hộp XYZ';

--10. Đơn đặt hàng số 1 do ai đặt và do nhân viên nào lập, thời gian và địa điểm giao hàng là ở đâu?

SELECT  D.SOHOADON, K.TENGIAODICH tenkhachhang, C.HO, C.TEN, D.NGAYDATHANG, D.NGAYCHUYENHANG, D.NGAYGIAOHANG,D.PXNo , D.soNhaTenDuong
FROM DONDATHANG D, NHANVIEN C, KHACHHANG K
WHERE D.MANHANVIEN = C.MANHANVIEN AND K.MAKHACHHANG = D.MAKHACHHANG 

--11.	Hãy cho biết số tiền lương mà công ty phải trả cho mỗi nhân viên là bao nhiêu (lương = lương cơ bản + phụ cấp).
SELECT MANHANVIEN,HO,TEN, LUONGCOBAN, PHUCAP,
	(LUONGCOBAN + PHUCAP) AS LUONG,
	DATEDIFF(month, NGAYLAMVIEC, GETDATE()) AS SOTHANGLAMVIEC,
	DATEDIFF(month, NGAYLAMVIEC, GETDATE()) *(LUONGCOBAN + PHUCAP) AS TONGLUONG
FROM NHANVIEN;

--12.	Hãy cho biết có những khách hàng nào lại chính là đối tác cung cấp hàng của công ty (tức là có cùng tên giao dịch).
SELECT KH.TENGIAODICH 
FROM  KHACHHANG KH
JOIN  NHACUNGCAP NCC 
ON KH.TENGIAODICH = NCC.TENCONGTY;

--13. Trong công ty có những nhân viên nào có cùng ngày sinh?
SELECT HO + ' ' + TEN AS [HỌ VÀ TÊN], NGAYSINH
FROM NHANVIEN
WHERE NGAYSINH IN (
        SELECT NGAYSINH 
        FROM NHANVIEN 
        GROUP BY NGAYSINH 
        HAVING COUNT(*) > 1
    )
ORDER BY NGAYSINH;

--14.	Những đơn đặt hàng nào yêu cầu giao hàng ngay tại công ty đặt hàng và những đơn đó là của công ty nào?
SELECT DDH.SOHOADON, KH.TENCONGTY
FROM DONDATHANG DDH, KHACHHANG KH
WHERE DDH.MAKHACHHANG = KH.MAKHACHHANG AND DDH.PXNo = KH.PXNo AND DDH.soNhaTenDuong = KH.soNhaTenDuong;

--15.	Cho biết tên công ty,  tên giao dịch, địa chỉ và điện thoại của các khách hàng và các nhà cung cấp hàng cho công ty.
SELECT TENCONGTY AS [TÊN CÔNG TY], TENGIAODICH AS [TÊN GIAO DỊCH], soNhaTenDuong, DIENTHOAI
FROM KHACHHANG
UNION
SELECT TENCONGTY, TENCONGTY AS [TÊN GIAO DỊCH], soNhaTenDuong, DIENTHOAI
FROM NHACUNGCAP;

--16.	Những mặt hàng nào chưa từng được khách hàng đặt mua?
SELECT TENHANG, MAHANG 
FROM MATHANG
WHERE MAHANG NOT IN (
        SELECT MAHANG 
        FROM CHITIETDONHANG
);

--17.	Những nhân viên nào của công ty chưa từng lập bất kỳ một hoá đơn đặt hàng nào?
SELECT HO + ' ' + TEN AS [HỌ TÊN], MANHANVIEN 
FROM NHANVIEN
WHERE MANHANVIEN NOT IN (
        SELECT MANHANVIEN 
        FROM DONDATHANG
    );

--18.	Những nhân viên nào của công ty có lương cơ bản cao nhất?
SELECT HO + ' ' + TEN AS [HỌ TÊN], LUONGCOBAN
FROM NHANVIEN
WHERE LUONGCOBAN = (SELECT MAX(LUONGCOBAN) 
                  FROM NHANVIEN);
